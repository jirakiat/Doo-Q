<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}


       <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/css/apple/app.min.css' %}" rel="stylesheet"/>
    <!-- ================== END BASE CSS STYLE ================== -->

    <!-- ================== BEGIN PAGE LEVEL CSS STYLE ================== -->
    <link href="{% static 'doqs/assets/plugins/jvectormap-next/jquery-jvectormap.css' %}" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/plugins/bootstrap-calendar/css/bootstrap_calendar.css' %}" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/plugins/gritter/css/jquery.gritter.css' %}" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/plugins/nvd3/build/nv.d3.css' %}" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
    <script src="https://fullcalendar.io/js/fullcalendar-2.3.1/fullcalendar.min.js"></script>
   <link href='https://cdn.jsdelivr.net/npm/fullcalendar@3.10.2/dist/fullcalendar.min.css' rel='stylesheet' />
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@3.10.2/dist/fullcalendar.print.css' rel='stylesheet' media='print' />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js'></script>
    <script>

    </script>
    <style>

        .fc td, .fc th {
            border-style: solid;
            border-width: 1px;
            padding: 0;
            vertical-align: top;
            font-size: 18px;
        }

        table {
            font-size: 18px;
        }

        .btnshow {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding-top: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }


        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
        }

        table.history {
            font-size: 18px;
        }

        input::-webkit-input-placeholder {
            font-size: 14px;
        }

        .modalcenter {
            top: 20%;
        }

        .scollshow {
            height: auto;
        }

        .inner-border::-webkit-scrollbar {
            display: none;
        }

        .check1 {
            transform: scale(1.9);
        }


        .show1 {
            position: absolute;
            display: block;
            width: 100%;
            color: black;
        }

        #divshowtest {
            overflow: hidden;
            z-index: 1;
            position: absolute;
            margin-left: 0.8%;
            bottom: 0;
            display: none;
            padding: 0;
        }

        tr.odd td:first-child,
        tr.even td:first-child {
            padding-left: 4em;
        }
    </style>
    <meta charset="UTF-8">
    <title>Doo-Q</title>
</head>
<body>
<div id="page-loader" class="fade show">
    <span class="spinner"></span>
</div>
<!-- end #page-loader -->

<!-- begin #page-container -->
<div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
    <!-- begin #header -->
    <div id="header" class="header navbar-default">
        <!-- begin navbar-header -->
        <div class="navbar-header">
            {% if request.session.permission == 1 %}
                <a href="{% url 'dashboard' %}" class="navbar-brand">
                <span class="navbar-logo"></span>
                Doo-Q
                เจ้าหน้าที่ {{ request.session.name }}
            {% else %}
                <a href="{% url 'calendar' %}" class="navbar-brand">
                <span class="navbar-logo"></span>
                Doo-Q
                ผู้ป่วย : {{ request.session.name }}
            {% endif %}</a>
            <button type="button" class="navbar-toggle" data-click="sidebar-toggled">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
            <span style="width: 100%;  position: relative;font-size: 18px;left: 35%;padding-top: 0.5%;">หน้ารับคิว</span>
        <!-- end navbar-header --><!-- begin header-nav -->
        <ul class="navbar-nav navbar-right">
            <li class="dropdown navbar-user">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    {% if request.session.permission == 1 %}
                        {% for datahospitals in datahospital %}
                            {% if dataST.Hid == datahospitals.Hid %}
                                <span class="d-none d-md-inline" style="font-size: 18px">{{ datahospitals.Hname }} -
                                    {% for dataDPMs in dataDPM %}
                                        {% if  dataDPMs.Did == Dids %}
                                            {{ dataDPMs.Dname }}
                                        {% endif %}
                                    {% endfor %}</span>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% if hospitalname %}
                            <span class="d-none d-md-inline"
                                  style="font-size: 18px">{{ hospitalname }} - {{ DPM }} </span>
                        {% endif %}
                    {% endif %}
                    {% if request.session.hn %}
                        <span class="d-none d-md-inline"
                              style="font-size: 18px">กำลังใช้บริการ - {{ request.session.hospital }} </span>
                    {% endif %}
                </a>
            </li>
        </ul>
        <!-- end header navigation right -->
    </div>
    <!-- end #header -->

    <!-- begin #sidebar -->
    <div id="sidebar" class="sidebar">
        <!-- begin sidebar scrollbar -->
        <div data-scrollbar="true" data-height="100%">
            <!-- begin sidebar user -->
            <ul class="nav">
                {% if request.session.permission == 1 %}
                    <li>
                        <a href="{% url 'dashboard' %}">
                            <i class="material-icons">dashboard</i>
                            <span>dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'callqueue2' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>เรียกคิว</span>
                        </a>
                    </li>
                    <li class="active" style="background-color: mediumseagreen">
                        <a href="{% url 'vtfbooking' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>รับคิว</span>
                        </a>
                    </li>
                    <li class="has-sub active">
                        <a href="{% url 'staff' %}">
                            <i class="material-icons">local_hospital</i>
                            <span style="text-align: left">แผนก/กลุ่มงาน</span>
                        </a>
                        <ul class="sub-menu">
                            <li class="has-sub">
                                <a href="{% url 'sthos' %}">
                                    <b class="caret"></b>
                                    <span style="text-align: left">แพทย์/เจ้าหน้าที่(ตามสังกัด)</span>
                                </a>
                            </li>
                        </ul>
                        <ul class="sub-menu">
                            <li class="has-sub">
                                <a href="{% url 'doctor' %}">
                                    <b class="caret"></b>
                                    <span>แผนรับคนไข้</span>
                                </a>
                            </li>
                        </ul>
                     <ul class="sub-menu" >
                            <li class="has-sub">
                                <a href="{% url 'tagdpm' %}">
                                    <b class="caret"></b>
                                    <span style="text-align: left;">เพิ่มแท็กกิจกรรม</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="{% url 'mnbook' %}">
                            <i class="material-icons">date_range</i>
                            <span>กำหนดช่วงเวลา</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'staffinfo' %}">
                            <i class="material-icons">supervised_user_circle</i>
                            <span>ข้อมูลส่วนตัว</span>
                        </a>
                    </li>
                {% else %}
                    <li>
                        <a href="{% url 'calendar' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>จองคิว</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'person' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>HN</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'personinfo' %}">
                            <i class="material-icons">supervised_user_circle</i>
                            <span>ข้อมูลส่วนตัว</span>
                        </a>
                    </li>
                {% endif %}
                <li>
                    <a href="{% url 'dessession' %}" class="btn btn-default">
                        <i class="material-icons">logout</i>
                        <span style="color: black;">ออกจากระบบ</span>
                    </a>
                </li>
            </ul>
            <!-- end sidebar nav -->
        </div>
        <!-- end sidebar scrollbar -->
    </div>
    <div class="sidebar-bg"></div>
    <div class="content" id="content">
        <div class="col-xl-12">
            <div class="row">
                {% if check == null %}
                    <div class="col-xl-3">
                        <form class="form-horizontal form-bordered" action="{% url 'stmcheck' %}" method="post">
                            {% csrf_token %}
                            <select class="form-control"
                                    name="re_sta">
                                <option value="">ทั้งแผนก</option>
                                {% for dataPersons in dataPerson %}
                                    {% for dataOFFalls in dataOFFall %}
                                        {% if dataPersons.Pid == dataOFFalls.Pid %}
                                            {% if  dataPersons.Pid == request.session.user_id %}
                                                <option value="{{ dataOFFalls.OFid }}"
                                                >{{ dataPersons.Pname }}</option>
                                            {% endif %}
                                            {% if dataOFFalls.Pid == dataPersons.Pid  and dataPersons.Pid != personid and dataOFFalls.Pid != request.session.user_id %}
                                                <option value="{{ dataOFFalls.OFid }}">{{ dataPersons.Pname }}</option>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </select>
                    </div>
                    <div class="col-xl-1">
                        <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                    </div>
                    </form>
                {% endif %}
                {% if check == 1 %}
                    <div class="col-xl-3">
                        <form class="form-horizontal form-bordered" action="{% url 'stmcheck' %}" method="post">
                            {% csrf_token %}
                            <select class="form-control"
                                    name="re_sta" id="staff">
                                {% if OFid == '' %}
                                    <option value="" selected>ทั้งแผนก</option>
                                {% else %}
                                    <option value="">ทั้งแผนก</option>
                                {% endif %}
                                {% for dataOFFalls in dataOFFall %}
                                    {% for dataPersons in dataPerson %}
                                        {% if dataPersons.Pid == dataOFFalls.Pid %}
                                            {% if  dataOFFalls.OFid == OFid %}
                                                <option value="{{ dataOFFalls.OFid }}"
                                                        selected>{{ dataPersons.Pname }}
                                                </option>
                                            {% else %}
                                                <option value="{{ dataOFFalls.OFid }}">{{ dataPersons.Pname }}</option>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </select>
                    </div>
                    <div class="col-xl-1">
                        <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                    </div>
                    </form>
                {% endif %}
                <div class="col-lg-4">
                </div>
                <div class="col-xl-4" style="font-size: 18px;">
                      <span class="float-right"
                            style="color: black">จำนวนผู้ป่วยที่แพทย์/เจ้าหน้าที่รับทั้งวัน  <span id="number"></span></span>
                    <br>
                    <span class="float-right"
                          style="color: black">จำนวนผู้ป่วยที่แผนกรับทั้งวัน <span id="dpm"></span></span>
                </div>

            </div>
        </div>
        <div class="col-xl-12">
            <!-- begin panel -->
            <div class="panel panel-inverse panel-with-tabs" data-sortable-id="ui-unlimited-tabs-1">
                <!-- begin panel-heading -->
                <div class="panel-heading p-0">
                    <!-- begin nav-tabs -->
                    <div class="tab-overflow">
                        <ul class="nav nav-tabs nav-tabs-inverse">
                            <li class="nav-item"><a href="#nav-tab-1" data-toggle="tab" class="nav-link active">รับคิว
                            </a></li>
                            <li class="nav-item"><a href="#nav-tab-2" data-toggle="tab" class="nav-link">สรุปยอดจอง
                            </a></li>
                        </ul>
                    </div>
                    <!-- end nav-tabs -->
                    <div class="panel-heading-btn mr-2 ml-2 d-flex">
                    </div>
                </div>
                <!-- end panel-heading -->
                <!-- begin tab-content -->
                <div class="panel-body tab-content ">
                    <!-- begin tab-pane -->
                    <div class="tab-pane fade active show" id="nav-tab-1">
                        <div class="panel panel-inverse" style="background: white">
                            <!-- begin panel-heading -->
                            <div class="row col-lg-12" style="margin: auto;height: auto;width: auto">
                                <div class="col-xl-4 col-sm-4">
                                    <br>
                                    {% if error != 5 %}

                                        <div id="calendarstaff" class="calendar scollshow inner-border  height-lg"
                                             style="height: 350px;width: 100%">
                                        </div>
                                    {% else %}
                                        <div class="col-lg-12">
                                            <div class="alert alert-danger fade show m-b-10">
                                                <span class="close" data-dismiss="alert">&times;</span>
                                                ยังไม่ได้กำหนดเวลารับนัด
                                            </div>
                                        </div>
                                    {% endif %}
                                </div>
                                <div class="col-xl-8 col-sm-8">
                                    <br>
                                    <table width="100%"
                                           class="table table-striped table-bordered dt-responsive nowrap test-list">
                                        <thead style="background-color: white;color: black;height: 10% ;text-align: center">
                                        <tr>
                                            <th colspan="5" scope="col" style="text-align: center;">วันที่<span
                                                    id="showdate">&nbsp;</span>เวลา <span id="showtime">&nbsp;</span>
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody style="font-size: 18px">
                                        <tr class="odd gradeX">
                                              <th class="text-nowrap" style="text-align: left;"> แพทย์/เจ้าหน้าที่</th>
                                            <th class="text-nowrap" style="text-align: left;">ผู้ป่วย</th>
                                            <th class="text-nowrap" style="text-align: left;">กิจกรรม</th>
                                              <th class="text-nowrap" style="text-align: center"><input type="checkbox" class="check1"
                                                                           onclick="checkalltime(this);"></th>
                                            <th class="text-nowrap" style="text-align: left;">สถานะ</th>
                                        </tr>
                                        </tbody>
                                        <tbody style="font-size: 18px;" id="myTablemoniter">

                                        </tbody>
                                    </table>
                                    <div class="float-right">
                                         <button class="btn btn-danger width-100 loadernoti" type="button" disabled
                                                style="width: 100%">
                                            <span class="spinner-border spinner-border-sm" role="status"
                                                  aria-hidden="true">
                                            </span>รอสักครู่
                                        </button>
                                        <button class="btn btn-danger width-100  btn-noverify">ปฏิเสธ</button>
                                        <button class="btn btn-primary width-100 btn-vertify">รับนัด</button>
                                        <button class="btn btn-primary width-100 loaderverti" type="button" disabled
                                                style="width: 100%">
                                            <span class="spinner-border spinner-border-sm" role="status"
                                                  aria-hidden="true">
                                            </span>รอสักครู่
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade" id="nav-tab-2">
                        <div class="panel panel-inverse" style="background: white">
                            <div class="col-xl-12 col-sm-6">

                                <br>
                                <table id="myTable"
                                       class="table  table-bordered dt-responsive nowrap test-list">
                                    <thead>
                                    <tr>
                                        <th colspan="4" style="text-align: center"><span id="history"
                                                                                         style="text-align: center">&nbsp;</span>
                                        </th>
                                    </tr>
                                    <tr>
                                        <th>แพทย์/เจ้าหน้าที่</th>
                                        <th>เวลา</th>
                                        <th>จำนวนจอง</th>
                                        <th>จำนวนที่รับ</th>
                                    </tr>
                                    </thead>
                                    <tbody id="myTablemoniterx">
                                    {% if bklistxs %}
                                        {% for bklistxs in bklistxs %}
                                            <tr class="tr-append-add1">
                                                <td>{{ bklistxs.5 }}</td>
                                                <td style="text-align: left">{{ bklistxs.1 }}-{{ bklistxs.2 }}</td>
                                                <td style="text-align: left">{{ bklistxs.4 }}</td>
                                                <td style="text-align: left">{{ bklistxs.3 }}</td>
                                            </tr>
                                        {% endfor %}

                                        </tbody>
                                        <tfoot>
                                        <tr class="tr-append-add1">
                                            <td style="text-align: left" colspan="2">รวม</td>
                                            <td style="text-align: left">{{ sumcount }}</td>
                                            <td style="text-align: left">{{ sumnumber }}</td>
                                        </tr>
                                        </tfoot>
                                    {% else %}
                                        <tfoot id="foothis">
                                        <tr class="tr-append-add1" style="text-align: center">
                                            <td colspan="4">ไม่มีข้อมูล</td>
                                        </tr>
                                        </tfoot>
                                    {% endif %}
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- end tab-pane -->
                    <!-- begin tab-pane -->
                    <!-- end tab-pane -->
                </div>
                <!-- end tab-content -->
            </div>
        </div>
        <div id="divshowtest" style="width: 84%;height: 400px">
            <div class="panel panel-inverse" data-sortable-id="table-basic-2">
                <!-- begin panel-heading -->
                <div class="panel-heading">
                    <h4 class="panel-title"> ประวัติผู้ป่วย <label id="showname"></label></h4>
                </div>
                <!-- end panel-heading -->
                <!-- begin panel-body -->
                <div class="panel-body" style="height: 400px;">
                    <div>
                        <div class="table-wrapper-scroll-y my-custom-scrollbar">
                            <table width="100%" class="table table-bordered table-striped mb-0 showhistory ">
                                <thead style="font-size: 18px">
                                <tr class="odd gradeX">
                                    </th>
                                    <th class="text-nowrap" style="text-align: left;">วันที่</th>
                                    <th class="text-nowrap" style="text-align: left;">เวลา</th>
                                    <th class="text-nowrap" style="text-align: left;"> แพทย์/เจ้าหน้าที่</th>
                                    <th class="text-nowrap" style="text-align: left;"> แผนก</th>
                                    <th class="text-nowrap" style="text-align: left;"> กิจกรรม</th>
                                    <th class="text-nowrap" style="text-align: left;"> สถานะ</th>
                                </tr>
                                </thead>
                                <tbody style="font-size: 18px;" id="showhistory">

                                </tbody>
                            </table>
                        </div>
                    </div>
                    <!-- end table-responsive -->
                </div>
                <!-- end panel-body -->
                <!-- begin hljs-wrapper -->

                <!-- end hljs-wrapper -->
            </div>
        </div>
    </div>
</div>
{% csrf_token %}
</body>
<script src="{% static 'doqs/assets/js/app.min.js' %}"></script>
<script src="{% static 'doqs/assets/js/theme/apple.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/d3/d3.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/nvd3/build/nv.d3.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-calendar/js/bootstrap_calendar.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/jquery-migrate/dist/jquery-migrate.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/moment/min/moment.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/ion-rangeslider/js/ion.rangeSlider.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/jquery.maskedinput/src/jquery.maskedinput.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/pwstrength-bootstrap/dist/pwstrength-bootstrap.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/@danielfarrell/bootstrap-combobox/js/bootstrap-combobox.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-select/dist/js/bootstrap-select.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/tag-it/js/tag-it.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/select2/dist/js/select2.min.js' %}"></script>
<script src="{% static 'doqs/assets/js/demo/table-manage-responsive.demo.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/d3/d3.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-show-password/dist/bootstrap-show-password.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-colorpalette/js/bootstrap-colorpalette.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/clipboard/dist/clipboard.min.js' %}"></script>
<script src="{% static 'doqs/assets/js/demo/form-plugins.demo.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/fullcalendar/dist/fullcalendar.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/fullcalendar/dist/locale/th.js' %}"></script>
<link href="{% static 'doqs/assets/plugins/ionicons/css/ionicons.min.css' %}" rel="stylesheet"/>
<script>

    $(function () {
//Created By: Brij Mohan
//Website: https://techbrij.com
        function groupTable($rows, startIndex, total) {
            if (total === 0) {
                return;
            }
            var i, currentIndex = startIndex, count = 1, lst = [];
            var tds = $rows.find('td:eq(' + currentIndex + ')');
            var ctrl = $(tds[0]);
            lst.push($rows[0]);
            for (i = 1; i <= tds.length; i++) {
                if (ctrl.text() == $(tds[i]).text()) {
                    count++;
                    $(tds[i]).addClass('deleted');
                    lst.push($rows[i]);
                } else {
                    if (count > 1) {
                        ctrl.attr('rowspan', count);
                        groupTable($(lst), startIndex + 1, total - 1)
                    }
                    count = 1;
                    lst = [];
                    ctrl = $(tds[i]);
                    lst.push($rows[i]);
                }
            }
        }

        groupTable($('#myTable tr:has(td)'), 0, 3);
        $('#myTable .deleted').remove();
    });
    var dateList = ''
    var OFid = ''
    var test_list_ids = ''
    var tglCurrent = ''
    var z = ''
    var datesxa = new Date();
    var timesst = ''
    var timesse = ''
        $('.loadernoti').hide();
    $('.loaderverti').hide();
    document.getElementById('history').innerHTML = toThaiDateString(datesxa);
    $(document).on('click', '.btn-noverify', function () {
        var checklist = [];
        $(".checkbox-timehos:checked").each(function () {
                var chesx = this.value
              $.ajax({
               url: '//www.doo-q.com/php/vtfnoqueue.php?checklist='+chesx+'',
            type: 'GET',
            processData: false,
            contentType: false,
            success: function (data) {
            }
                    });
            checklist.push(this.value);
        });
          $('.loadernoti').show();
        $('.btn-noverify').hide();
        var checklist = JSON.stringify(checklist);
        OFid = "{{OFid}}"
        test_list_ids = JSON.stringify(dateList);
        $.ajax({
            url: "{% url 'verifydontbooking' %}",
            type: 'POST',
            data: {
                'checklist': checklist,
                'OFid': OFid,
                'test_list_ids': test_list_ids,
                'timesse': timesse,
                'timesst': timesst,
                'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
            },
            success: function (data) {
                 $('.loadernoti').hide();
                $('.btn-noverify').show();
                $('.tr-append-add').remove();
                if (data.bookingper.length > 0) {
                    jQuery.each(data.bookingper, function (index, item) {

                        $('.description' + item[0] + '').html("&nbsp;" + item[3]);
                        $('.startdate' + item[0] + '').html("&nbsp;" + item[3]);
                        $('.enddate' + item[0] + '').html("&nbsp;" + item[3]);
                        if (index == 0) {
                            $('.tr-append-add').remove();
                        }
                        if (item[5] == 0) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' +
                                '<button  data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                '</button>' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>กิจกรรม: ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                 '<td  style="width: 50px;text-align: center">' +
                                '<input type="checkbox" id="checkbox1" name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '">' +
                                '</td>' +
                                '<td style="width: 285px;color: blue">' +
                                '<span>รอดำเนินการ' +
                                '</span>' +
                                '</td>' +
                                '</tr>'
                            )
                        }
                        if (item[5] == 1 || item[5] == 3) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                '<td style="width: 285px;text-align: center;">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' +
                                '<button   data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                '</button>' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>กิจกรรม: ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                  '<td  style="width: 50px;text-align: center">' +
                                '<input type="checkbox"  name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '" disabled>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left;color: green">' +
                                '<span>รับนัด' +
                                '</span>' +
                                '</td>' +
                                '</tr>')
                        }
                        if (item[5] == 2 || item[5] == 4) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                 '<td style="width: 285px;text-align: center;">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' +
                                '<button  data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                '</button>' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>กิจกรรม: ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                 '<td  style="width: 50px;text-align: center">' +
                                '<input type="checkbox" name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '" disabled>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left;color: red">' +
                                '<span>ปฏิเสธ' +
                                '</span>' +
                                '</td>' +
                                '</tr>')
                        }
                    });
                } else {
                    $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                        '<td colspan="5" style="text-align: center">ไม่มีข้อมูล' +
                        '</td>' +
                        '</tr>')
                }
                $(function () {
                    function groupTable($rows, startIndex, total) {
                        if (total === 0) {
                            return;
                        }
                        var i, currentIndex = startIndex, count = 1, lst = [];
                        var tds = $rows.find('td:eq(' + currentIndex + ')');
                        var ctrl = $(tds[0]);
                        lst.push($rows[0]);
                        for (i = 1; i <= tds.length; i++) {
                            if (ctrl.text() == $(tds[i]).text()) {
                                count++;
                                $(tds[i]).addClass('deleted');
                                lst.push($rows[i]);
                            } else {
                                if (count > 1) {
                                    ctrl.attr('rowspan', count);
                                    groupTable($(lst), startIndex + 1, total - 1)
                                }
                                count = 1;
                                lst = [];
                                ctrl = $(tds[i]);
                                lst.push($rows[i]);
                            }
                        }
                    }

                    groupTable($('#myTablemoniter tr:has(td)'), 0, 3);
                    $('#myTablemoniter .deleted').remove();
                });

            }
        })
    });
    $(document).on('click', '.btn-vertify', function () {
        $('.scrollable_notifications').toggle();
        var checklist = [];
        $(".checkbox-timehos:checked").each(function () {
            var chesx = this.value
              $.ajax({
               url: '//www.doo-q.com/php/vtfqueue.php?checklist='+chesx+'',
            type: 'GET',
            processData: false,
            contentType: false,
            success: function (data) {
            }
                    });
            checklist.push(this.value);



        });
         $('.loaderverti').show();
        $('.btn-vertify').hide();
        var checklist = JSON.stringify(checklist);
        OFid = "{{OFid}}"
        test_list_ids = JSON.stringify(dateList);
        $.ajax({
            url: "{% url 'verifybooking' %}",
            type: 'POST',
            data: {
                'checklist': checklist,
                'OFid': OFid,
                'test_list_ids': test_list_ids,
                'timesse': timesse,
                'timesst': timesst,
                'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
            },
            success: function (data) {
                  $('.loaderverti').hide();
                 $('.btn-vertify').show();
                $('.tr-append-add').remove();
                if (data.bookingper.length > 0) {
                    jQuery.each(data.bookingper, function (index, item) {

                        $('.description' + item[0] + '').html("&nbsp;" + item[3]);
                        $('.startdate' + item[0] + '').html("&nbsp;" + item[3]);
                        $('.enddate' + item[0] + '').html("&nbsp;" + item[3]);
                        if (index == 0) {
                            $('.tr-append-add').remove();
                        }
                        if (item[5] == 0) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' +
                                '<button  data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                '</button>' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>กิจกรรม: ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                 '<td  style="width: 50px;text-align: center">' +
                                '<input type="checkbox" id="checkbox1" name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '">' +
                                '</td>' +
                                '<td style="width: 285px;color: blue">' +
                                '<span>รอดำเนินการ' +
                                '</span>' +
                                '</td>' +
                                '</tr>'
                            )
                        }
                        if (item[5] == 1 || item[5] == 3) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                '<td style="width: 285px;text-align: center;">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' +
                                '<button   data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                '</button>' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>กิจกรรม: ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                '<td  style="width: 50px;text-align: center">' +
                                '<input type="checkbox"  name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '" disabled>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left;color: green">' +
                                '<span>รับนัด' +
                                '</span>' +
                                '</td>' +
                                '</tr>')
                        }
                        if (item[5] == 2 || item[5] == 4) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                '<td style="width: 285px;text-align: center;">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' +
                                '<button  data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                '</button>' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>กิจกรรม: ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                 '<td  style="width: 50px;text-align: center">' +
                                '<input type="checkbox"  name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '" disabled>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left;color: red">' +
                                '<span>ปฏิเสธ' +
                                '</span>' +
                                '</td>' +
                                '</tr>')
                        }
                    });
                } else {
                    $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                        '<td colspan="5" style="text-align: center">ไม่มีข้อมูล' +
                        '</td>' +
                        '</tr>')
                }
                $(function () {
                    function groupTable($rows, startIndex, total) {
                        if (total === 0) {
                            return;
                        }
                        var i, currentIndex = startIndex, count = 1, lst = [];
                        var tds = $rows.find('td:eq(' + currentIndex + ')');
                        var ctrl = $(tds[0]);
                        lst.push($rows[0]);
                        for (i = 1; i <= tds.length; i++) {
                            if (ctrl.text() == $(tds[i]).text()) {
                                count++;
                                $(tds[i]).addClass('deleted');
                                lst.push($rows[i]);
                            } else {
                                if (count > 1) {
                                    ctrl.attr('rowspan', count);
                                    groupTable($(lst), startIndex + 1, total - 1)
                                }
                                count = 1;
                                lst = [];
                                ctrl = $(tds[i]);
                                lst.push($rows[i]);
                            }
                        }
                    }

                    groupTable($('#myTablemoniter tr:has(td)'), 0, 3);
                    $('#myTablemoniter .deleted').remove();
                });

            }
        })
    });

    function toThaiDateString(date) {
        let monthNames = [
            "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน",
            "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม.",
            "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
        ];

        let year = date.getFullYear() + 543;
        let month = monthNames[date.getMonth()];
        let numOfDay = date.getDate();

        let hour = date.getHours().toString().padStart(2, "0");
        let minutes = date.getMinutes().toString().padStart(2, "0");
        let second = date.getSeconds().toString().padStart(2, "0");

        return ` ${numOfDay} ${month} ${year} `;
    }

    $(document).on('click', '.fc-prev-button', function () {
        var $this = $(this);
        setTimeout(function () {
            tglCurrent = $('#calendarstaff').fullCalendar('getDate');
            z = new Date(tglCurrent).toISOString().split('T')[0];
            OFid = "{{OFid}}"
            test_list_ids = JSON.stringify(z);
            $.ajax({
                url: "{% url 'historybooks' %}",
                type: 'POST',
                data: {
                    'test_list_ids': test_list_ids,
                    'OFid': OFid,
                    'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
                },
                success: function (data) {
                    var x = data.sumcount
                    var y = data.sumnumber
                    var datesx = new Date(z);
                    document.getElementById('history').innerHTML = toThaiDateString(datesx);
                    $('.tr-append-add1').remove();
                    if (data.bklistxs.length > 0) {
                        jQuery.each(data.bklistxs, function (index, item) {
                            $('#myTable').append('<tr class="tr-append-add1"> ' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[5] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[1] + '-' + item[2] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + '' +
                                '</span>' +
                                '</td>' +
                                '</tr>'
                            )
                        });
                        $('#foothis').append('<tr class="tr-append-add1"> ' +
                            '<td  colspan="2" style="width: 285px;text-align: left">' +
                            '<span>รวม' +
                            '</span>' +
                            '</td>' +
                            '<td style="width: 285px;text-align: left">' +
                            '<span>' + x + '' +
                            '</span>' +
                            '</td>' +
                            '<td style="width: 285px;text-align: left">' +
                            '<span>' + y + '' +
                            '</span>' +
                            '</td>' +
                            '</tr>'
                        )
                        $(function () {
                            function groupTable($rows, startIndex, total) {
                                if (total === 0) {
                                    return;
                                }
                                var i, currentIndex = startIndex, count = 1, lst = [];
                                var tds = $rows.find('td:eq(' + currentIndex + ')');
                                var ctrl = $(tds[0]);
                                lst.push($rows[0]);
                                for (i = 1; i <= tds.length; i++) {
                                    if (ctrl.text() == $(tds[i]).text()) {
                                        count++;
                                        $(tds[i]).addClass('deleted');
                                        lst.push($rows[i]);
                                    } else {
                                        if (count > 1) {
                                            ctrl.attr('rowspan', count);
                                            groupTable($(lst), startIndex + 1, total - 1)
                                        }
                                        count = 1;
                                        lst = [];
                                        ctrl = $(tds[i]);
                                        lst.push($rows[i]);
                                    }
                                }
                            }

                            groupTable($('#myTable tr:has(td)'), 0, 3);
                            $('#myTable .deleted').remove();
                        });

                    } else {
                        $('#myTable').append('<tr class="tr-append-add1"> ' +
                            '<td colspan="5" style="text-align: center">ไม่มีข้อมูล' +
                            '</td>' +
                            '</tr>')
                    }
                }
            })

        }, 1);
    });
    $(document).on('click', '.fc-next-button', function () {
        var $this = $(this);
        setTimeout(function () {
            tglCurrent = $('#calendarstaff').fullCalendar('getDate');
            z = new Date(tglCurrent).toISOString().split('T')[0];
            OFid = "{{OFid}}"
            test_list_ids = JSON.stringify(z);
            $.ajax({
                url: "{% url 'historybooks' %}",
                type: 'POST',
                data: {
                    'test_list_ids': test_list_ids,
                    'OFid': OFid,
                    'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
                },
                success: function (data) {
                    var x = data.sumcount
                    var y = data.sumnumber
                    var datesx = new Date(z);
                    document.getElementById('history').innerHTML = toThaiDateString(datesx);
                    $('.tr-append-add1').remove();
                    if (data.bklistxs.length > 0) {
                        jQuery.each(data.bklistxs, function (index, item) {
                            $('#myTable').append('<tr class="tr-append-add1"> ' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[5] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[1] + '-' + item[2] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + '' +
                                '</span>' +
                                '</td>' +
                                '</tr>'
                            )
                        });
                        $('#foothis').append('<tr class="tr-append-add1"> ' +
                            '<td  colspan="2" style="width: 285px;text-align: left">' +
                            '<span>รวม' +
                            '</span>' +
                            '</td>' +
                            '<td style="width: 285px;text-align: left">' +
                            '<span>' + x + '' +
                            '</span>' +
                            '</td>' +
                            '<td style="width: 285px;text-align: left">' +
                            '<span>' + y + '' +
                            '</span>' +
                            '</td>' +
                            '</tr>'
                        )
                        $(function () {
                            function groupTable($rows, startIndex, total) {
                                if (total === 0) {
                                    return;
                                }
                                var i, currentIndex = startIndex, count = 1, lst = [];
                                var tds = $rows.find('td:eq(' + currentIndex + ')');
                                var ctrl = $(tds[0]);
                                lst.push($rows[0]);
                                for (i = 1; i <= tds.length; i++) {
                                    if (ctrl.text() == $(tds[i]).text()) {
                                        count++;
                                        $(tds[i]).addClass('deleted');
                                        lst.push($rows[i]);
                                    } else {
                                        if (count > 1) {
                                            ctrl.attr('rowspan', count);
                                            groupTable($(lst), startIndex + 1, total - 1)
                                        }
                                        count = 1;
                                        lst = [];
                                        ctrl = $(tds[i]);
                                        lst.push($rows[i]);
                                    }
                                }
                            }

                            groupTable($('#myTable tr:has(td)'), 0, 3);
                            $('#myTable .deleted').remove();
                        });

                    } else {
                        $('#myTable').append('<tr class="tr-append-add1"> ' +
                            '<td colspan="5" style="text-align: center">ไม่มีข้อมูล' +
                            '</td>' +
                            '</tr>')
                    }
                }
            })

        }, 1);
    });
    $(document).ready(function () {
        var calendar = $('#calendarstaff').fullCalendar({
                eventClick: function (info) {
                    alert('Event: ' + info.event.title);
                    alert('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY);
                    alert('View: ' + info.view.type);

                    // change the border color just for fun
                    info.el.style.borderColor = 'red';
                },
                displayEventTime: false,
                eventLimit: false,
                draggable: false,
                defaultView: 'listDay',
                locale: 'th',
                firstDay: 0,
                header: {
                    left: 'listDay',
                    center: 'title',
                    right: 'prev,next',
                },
                events: [
                    {% for myresults in bookingshow %}
                        {
                            start: '{{ myresults.0 }}',
                            end: '{{ myresults.0 }}',
                            title: '{{ myresults.1 }} - {{ myresults.2 }}',
                            color: 'green',
                            school: '{{ myresults.0 }}',
                            timess: '{{ myresults.1 }}',
                            timesxe: '{{ myresults.2 }}',
                            timessex: '{{ myresults.1 }} - {{ myresults.2 }}',
                        },
                    {% endfor %}
                ],
                eventClick: function (event, jsEvent, view) {
                    dateList = event.school
                    timesst = event.timess
                    timesse = event.timesxe
                    timessx = event.timessex
                    OFid = "{{OFid}}"
                    test_list_ids = JSON.stringify(dateList);
                    $.ajax({
                        url: "{% url 'filterstaffmoniter' %}",
                        type: 'POST',
                        data: {
                            'test_list_ids': test_list_ids,
                            'OFid': OFid,
                            'timesst': timesst,
                            'timesse': timesse,
                            'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
                        },
                        success: function (data) {
                            console.log(data)
                            $('.tr-append-add').remove();
                            document.getElementById('dpm').innerHTML = data.numberDPMtoday;
                            document.getElementById('number').innerHTML = data.numbertoday;
                            document.getElementById('showtime').innerHTML = timessx;
                            var dates = new Date(dateList);
                            document.getElementById('showdate').innerHTML = toThaiDateString(dates);
                            console.log(data.bookingper.length)
                            if (data.bookingper.length > 0) {
                                jQuery.each(data.bookingper, function (index, item) {

                                    $('.description' + item[0] + '').html("&nbsp;" + item[3]);
                                    $('.startdate' + item[0] + '').html("&nbsp;" + item[3]);
                                    $('.enddate' + item[0] + '').html("&nbsp;" + item[3]);
                                    if (index == 0) {
                                        $('.tr-append-add').remove();
                                    }
                                    if (item[5] == 0) {
                                        $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>' + item[4] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>' + item[3] + ' : ' +
                                            '<button  data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                            '</button>' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>กิจกรรม: ' + item[1] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td  style="width: 50px;text-align: center">' +
                                            '<input type="checkbox" id="checkbox1" name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '">' +
                                            '</td>' +
                                            '<td style="width: 285px;color: blue">' +
                                            '<span>รอดำเนินการ' +
                                            '</span>' +
                                            '</td>' +
                                            '</tr>'
                                        )
                                    }
                                    if (item[5] == 1 || item[5] == 3) {
                                        $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                            '<td style="width: 285px;text-align: center;">' +
                                            '<span>' + item[4] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>' + item[3] + ' : ' +
                                            '<button   data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                            '</button>' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>กิจกรรม: ' + item[1] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td  style="width: 50px;text-align: center">' +
                                            '<input type="checkbox"  name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '" disabled>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left;color: green">' +
                                            '<span>รับนัด' +
                                            '</span>' +
                                            '</td>' +
                                            '</tr>')
                                    }
                                    if (item[5] == 2 || item[5] == 4) {
                                        $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                            '<td style="width: 285px;text-align: center;">' +
                                            '<span>' + item[4] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>' + item[3] + ' : ' +
                                            '<button  data-click="panel-collapse" style="font-size: 18px;" onclick="dosomething(this.value)" class="btn btn-link" value="' + item[0] + '">' + item[2] + '' +
                                            '</button>' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>กิจกรรม: ' + item[1] + '' +
                                            '</span>' +
                                            '</td>' +
                                             '<td  style="width: 50px;text-align: center">' +
                                            '<input type="checkbox"  name="test" class="checkbox-hospitaltime-id checkbox-timehos check1" value="' + item[0] + '" disabled>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left;color: red">' +
                                            '<span>ปฏิเสธ' +
                                            '</span>' +
                                            '</td>' +
                                            '</tr>')
                                    }
                                });
                            } else {
                                $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                    '<td colspan="5" style="text-align: center">ไม่มีข้อมูล' +
                                    '</td>' +
                                    '</tr>')
                            }
                            $(function () {
                                function groupTable($rows, startIndex, total) {
                                    if (total === 0) {
                                        return;
                                    }
                                    var i, currentIndex = startIndex, count = 1, lst = [];
                                    var tds = $rows.find('td:eq(' + currentIndex + ')');
                                    var ctrl = $(tds[0]);
                                    lst.push($rows[0]);
                                    for (i = 1; i <= tds.length; i++) {
                                        if (ctrl.text() == $(tds[i]).text()) {
                                            count++;
                                            $(tds[i]).addClass('deleted');
                                            lst.push($rows[i]);
                                        } else {
                                            if (count > 1) {
                                                ctrl.attr('rowspan', count);
                                                groupTable($(lst), startIndex + 1, total - 1)
                                            }
                                            count = 1;
                                            lst = [];
                                            ctrl = $(tds[i]);
                                            lst.push($rows[i]);
                                        }
                                    }
                                }

                                groupTable($('#myTablemoniter tr:has(td)'), 0);
                                $('#myTablemoniter .deleted').remove();
                            });

                        }
                    })
                }
            })
        ;

    });
    $(".btn-dishis").click(function () {
        $('#historyshow').hide();
    });
    $('#historyshow').hide();

    function checkalltime(source) {
        var checkboxes = document.querySelectorAll('input[id="checkbox1"]');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i] != source)
                checkboxes[i].checked = source.checked;
        }
    }


    function dosomething(val) {
        $.ajax({
            url: "{% url 'filtermodal' %}",
            type: 'POST',
            data: {
                'idcheck': val,
                'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
            },
            success: function (data) {
                $('#historyshow').show();
                jQuery.each(data.modallist, function (index, item) {
                    var d = new Date(item[2]);
                    document.getElementById('showname').innerHTML = item[8];
                    if (index == 0) {
                        $('.historyshow').remove();
                    }
                    $('#showhistory').append('<tr class="historyshow"> ' +
                        '<td  style="width: 50px;">' +
                        '<span>' + toThaiDateString(d) + '' +
                        '</span>' +
                        '</td>' +
                        '<td style="width: 50px;text-align: left">' +
                        '<span>' + item[3] + ' - ' + item[4] + '' +
                        '</span>' +
                        '</td>' +
                        '<td style="width: 50px;text-align: left">' +
                        '<span>' + item[5] + '' +
                        '</span>' +
                        '</td>' +
                        '<td style="width: 50px;text-align: left">' +
                        '<span>' + item[6] + '' +
                        '</span>' +
                        '</td>' +
                        '<td style="width: 50px;text-align: left">' +
                        '<span>' + item[1] + '' +
                        '</span>' +
                        '</td>' +
                        '<td style="width: 50px;text-align: left">' +
                        '<span>' + item[7] + '' +
                        '</span>' +
                        '</td>' +

                        '</tr>'
                    )
                });
                $("#divshowtest").slideToggle("slow");

            },
        })
    }
</script>
</html>
