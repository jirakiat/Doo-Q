<!DOCTYPE html>
<html lang="en">
<head>
    {% load static %}


    <link href="https://fonts.googleapis.com/css?family=Roboto:100,300,400,500,700,900" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/css/apple/app.min.css' %}" rel="stylesheet"/>
    <!-- ================== END BASE CSS STYLE ================== -->

    <!-- ================== BEGIN PAGE LEVEL CSS STYLE ================== -->
    <link href="{% static 'doqs/assets/plugins/jvectormap-next/jquery-jvectormap.css' %}" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/plugins/bootstrap-calendar/css/bootstrap_calendar.css' %}" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/plugins/gritter/css/jquery.gritter.css' %}" rel="stylesheet"/>
    <link href="{% static 'doqs/assets/plugins/nvd3/build/nv.d3.css' %}" rel="stylesheet"/>
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Kanit&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.15.1/moment.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/js/bootstrap-datetimepicker.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.9.0/moment.min.js"></script>
    <script src="https://fullcalendar.io/js/fullcalendar-2.3.1/fullcalendar.min.js"></script>
   <link href='https://cdn.jsdelivr.net/npm/fullcalendar@3.10.2/dist/fullcalendar.min.css' rel='stylesheet' />
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@3.10.2/dist/fullcalendar.print.css' rel='stylesheet' media='print' />
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-datetimepicker/4.7.14/css/bootstrap-datetimepicker.min.css">
    <script src='https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.4.0/Chart.min.js'></script>


    <style>

        .fc td, .fc th {
            border-style: solid;
            border-width: 1px;
            padding: 0;
            vertical-align: top;
            font-size: 18px;
        }

        table {
            font-size: 18px;
        }

        .btnshow {
            background-color: #4CAF50; /* Green */
            border: none;
            color: white;
            padding-top: 10px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 16px;
        }


        body {
            font-family: 'Kanit', sans-serif;
            margin: 0;
            padding: 0;
        }

        table.history {
            font-size: 18px;
        }

        input::-webkit-input-placeholder {
            font-size: 14px;
        }

        .modalcenter {
            top: 20%;
        }

        .scollshow {
            height: auto;
        }

        .inner-border::-webkit-scrollbar {
            display: none;
        }

        .check1 {
            transform: scale(1.9);
        }


        .show1 {
            position: absolute;
            display: block;
            width: 100%;
            color: black;
        }

        #divshowtest {
            overflow: hidden;
            z-index: 1;
            position: absolute;
            margin-left: 0.8%;
            bottom: 0;
            display: none;
            padding: 0;
        }

    </style>
    <meta charset="UTF-8">
    <title>Doo-Q</title>
</head>
<body>
<div id="page-loader" class="fade show">
    <span class="spinner"></span>
</div>
<!-- end #page-loader -->

<!-- begin #page-container -->
<div id="page-container" class="fade page-sidebar-fixed page-header-fixed">
    <!-- begin #header -->
    <div id="header" class="header navbar-default">
        <!-- begin navbar-header -->
        <div class="navbar-header">
            {% if request.session.permission == 1 %}
                <a href="{% url 'dashboard' %}" class="navbar-brand">
                <span class="navbar-logo"></span>
                Doo-Q
                เจ้าหน้าที่ {{ request.session.name }}
            {% else %}
                <a href="{% url 'calendar' %}" class="navbar-brand">
                <span class="navbar-logo"></span>
                Doo-Q
                ผู้ป่วย : {{ request.session.name }}
            {% endif %}</a>
            <button type="button" class="navbar-toggle" data-click="sidebar-toggled">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        </div>
            <span style="width: 100%;  position: relative;font-size: 18px;left: 35%;padding-top: 0.5%;">หน้าเรียกคิว</span>
        <!-- end navbar-header --><!-- begin header-nav -->
        <ul class="navbar-nav navbar-right">
            <li class="dropdown navbar-user">
                <a href="#" class="dropdown-toggle" data-toggle="dropdown">
                    {% if request.session.permission == 1 %}
                        {% for datahospitals in datahospital %}
                            {% if dataST.Hid == datahospitals.Hid %}
                                <span class="d-none d-md-inline" style="font-size: 18px">{{ datahospitals.Hname }} -
                                    {% for dataDPMs in dataDPM %}
                                        {% if  dataDPMs.Did == Dids %}
                                            {{ dataDPMs.Dname }}
                                        {% endif %}
                                    {% endfor %}</span>
                            {% endif %}
                        {% endfor %}
                    {% else %}
                        {% if hospitalname %}
                            <span class="d-none d-md-inline"
                                  style="font-size: 18px">{{ hospitalname }} - {{ DPM }} </span>
                        {% endif %}
                    {% endif %}
                    {% if request.session.hn %}
                        <span class="d-none d-md-inline"
                              style="font-size: 18px">กำลังใช้บริการ - {{ request.session.hospital }} </span>
                    {% endif %}
                </a>
            </li>
        </ul>
        <!-- end header navigation right -->
    </div>
    <!-- end #header -->

    <!-- begin #sidebar -->
    <div id="sidebar" class="sidebar">
        <!-- begin sidebar scrollbar -->
        <div data-scrollbar="true" data-height="100%">
            <!-- begin sidebar user -->
            <ul class="nav">
                {% if request.session.permission == 1 %}
                    <li>
                        <a href="{% url 'dashboard' %}">
                            <i class="material-icons">dashboard</i>
                            <span>dashboard</span>
                        </a>
                    </li>
                    <li class="active " style="background-color: mediumseagreen">
                        <a href="{% url 'callqueue2' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>เรียกคิว</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'vtfbooking' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>รับคิว</span>
                        </a>
                    </li>
                    <li class="has-sub active">
                        <a href="{% url 'staff' %}">
                            <i class="material-icons">local_hospital</i>
                            <span style="text-align: left">แผนก/กลุ่มงาน</span>
                        </a>
                        <ul class="sub-menu">
                            <li class="has-sub">
                                <a href="{% url 'sthos' %}">
                                    <b class="caret"></b>
                                    <span style="text-align: left">แพทย์/เจ้าหน้าที่(ตามสังกัด)</span>
                                </a>
                            </li>
                        </ul>
                        <ul class="sub-menu">
                            <li class="has-sub">
                                <a href="{% url 'doctor' %}">
                                    <b class="caret"></b>
                                    <span>แผนรับคนไข้</span>
                                </a>
                            </li>
                        </ul>
                     <ul class="sub-menu" >
                            <li class="has-sub">
                                <a href="{% url 'tagdpm' %}">
                                    <b class="caret"></b>
                                    <span style="text-align: left;">เพิ่มแท็กกิจกรรม</span>
                                </a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="{% url 'mnbook' %}">
                            <i class="material-icons">date_range</i>
                            <span>กำหนดช่วงเวลา</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'staffinfo' %}">
                            <i class="material-icons">supervised_user_circle</i>
                            <span>ข้อมูลส่วนตัว</span>
                        </a>
                    </li>
                {% else %}
                    <li>
                        <a href="{% url 'calendar' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>จองคิว</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'person' %}">
                            <i class="material-icons">calendar_today</i>
                            <span>HN</span>
                        </a>
                    </li>
                    <li>
                        <a href="{% url 'personinfo' %}">
                            <i class="material-icons">supervised_user_circle</i>
                            <span>ข้อมูลส่วนตัว</span>
                        </a>
                    </li>
                {% endif %}
                <li>
                    <a href="{% url 'dessession' %}" class="btn btn-default">
                        <i class="material-icons">logout</i>
                        <span style="color: black;">ออกจากระบบ</span>
                    </a>
                </li>
            </ul>
            <!-- end sidebar nav -->
        </div>
        <!-- end sidebar scrollbar -->
    </div>
    <div class="sidebar-bg"></div>
    <div class="content" id="content">
        <div class="col-xl-12">
            <div class="row">
                {% if check == null %}
                    <div class="col-xl-3">
                        <form class="form-horizontal form-bordered" action="{% url 'callqueueck' %}" method="post">
                            {% csrf_token %}
                            <select class="form-control"
                                    name="re_sta">
                                <option value="">ทั้งแผนก</option>
                                {% for dataPersons in dataPerson %}
                                    {% for dataOFFalls in dataOFFall %}
                                        {% if dataPersons.Pid == dataOFFalls.Pid %}
                                            {% if  dataPersons.Pid == request.session.user_id %}
                                                <option value="{{ dataOFFalls.OFid }}"
                                                >{{ dataPersons.Pname }}</option>
                                            {% endif %}
                                            {% if dataOFFalls.Pid == dataPersons.Pid  and dataPersons.Pid != personid and dataOFFalls.Pid != request.session.user_id %}
                                                <option value="{{ dataOFFalls.OFid }}">{{ dataPersons.Pname }}</option>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </select>
                    </div>
                    <div class="col-xl-1">
                        <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                    </div>
                    </form>
                {% endif %}
                {% if check == 1 %}
                    <div class="col-xl-3">
                        <form class="form-horizontal form-bordered" action="{% url 'callqueueck' %}" method="post">
                            {% csrf_token %}
                            <select class="form-control"
                                    name="re_sta" id="staff">
                                {% if OFid == '' %}
                                    <option value="" selected>ทั้งแผนก</option>
                                {% else %}
                                    <option value="">ทั้งแผนก</option>
                                {% endif %}
                                {% for dataOFFalls in dataOFFall %}
                                    {% for dataPersons in dataPerson %}
                                        {% if dataPersons.Pid == dataOFFalls.Pid %}
                                            {% if  dataOFFalls.OFid == OFid %}
                                                <option value="{{ dataOFFalls.OFid }}"
                                                        selected>{{ dataPersons.Pname }}
                                                </option>
                                            {% else %}
                                                <option value="{{ dataOFFalls.OFid }}">{{ dataPersons.Pname }}</option>
                                            {% endif %}
                                        {% endif %}
                                    {% endfor %}
                                {% endfor %}
                            </select>
                    </div>
                    <div class="col-xl-1">
                        <button type="submit" class="btn btn-default"><i class="fas fa-search"></i></button>
                    </div>
                    </form>
                {% endif %}
            </div>
        </div>
        <br>
        <div class="col-xl-12">
            <!-- begin panel -->
            <div class="panel panel-inverse panel-with-tabs" data-sortable-id="ui-unlimited-tabs-1">
                <!-- begin panel-heading -->
                <div class="panel-heading p-0">
                    <!-- begin nav-tabs -->
                    <div class="tab-overflow">
                        <ul class="nav nav-tabs nav-tabs-inverse">
                            <li class="nav-item"><a href="#nav-tab-1" data-toggle="tab" class="nav-link active">เรียกคิว
                            </a></li>
                            <li class="nav-item"><a href="#nav-tab-2" data-toggle="tab" class="nav-link">สรุปยอดจอง
                            </a></li>
                        </ul>
                    </div>
                    <!-- end nav-tabs -->
                    <div class="panel-heading-btn mr-2 ml-2 d-flex">
                    </div>
                </div>
                <!-- end panel-heading -->
                <!-- begin tab-content -->
                <div class="panel-body tab-content ">
                    <!-- begin tab-pane -->
                    <div class="tab-pane fade active show" id="nav-tab-1">
                        <div class="panel panel-inverse" style="background: white">
                            <!-- begin panel-heading -->
                            <div class="row col-lg-12" style="margin: auto;text-align: center;height: auto;width: auto">
                                <div class="col-xl-4 col-sm-4">
                                    <br>
                                    <div id="calendarcallqueue" class="calendar scollshow inner-border  height-lg">
                                    </div>
                                </div>
                                <div class="col-xl-8 col-sm-6">
                                    <br>
                                    <table id="myTable" class="table table-striped table-bordered dt-responsive nowrap"
                                           style="width:100%">
                                        <thead style="font-size: 18px">
                                        <tr>
                                            <th colspan="5">เวลา <span id="showtime"></span></th>
                                        </tr>
                                        <tr class="odd gradeX">
                                            </th>
                                            <th onclick="sortTable(0)" id="row1" class="text-nowrap"
                                                style="text-align: left;">
                                                แพทย์/เจ้าหน้าที่
                                            </th>
                                            <th onclick="sortTable(3)" class="text-nowrap" style="text-align: left;">
                                             ลำดับ
                                            </th>
                                            <th onclick="sortTable(1)" class="text-nowrap" style="text-align: left;">
                                                ผู้ป่วย
                                            </th>
                                            <th onclick="sortTable(2)" class="text-nowrap" style="text-align: left;">
                                                กิจกรรม
                                            </th>
                                            <th onclick="sortTable(4)" class="text-nowrap" style="text-align: left;">
                                                เรียกคิว
                                            </th>
                                        </tr>
                                        </thead>
                                        <tbody style="font-size: 18px;" id="myTablemoniter">
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="tab-pane fade " id="nav-tab-2">
                        <div class="panel panel-inverse" style="background: white">
                            <div class="col-xl-12 col-sm-6">
                                <br>
                                <table id="myTablex"
                                       class="table table-striped table-bordered dt-responsive nowrap test-list">
                                    <thead>
                                    <tr>
                                        <th>แพทย์/เจ้าหน้าที่</th>
                                        <th>เวลา</th>
                                        <th>จำนวนจอง</th>
                                        <th>จำนวนที่รับ</th>
                                    </tr>
                                    </thead>
                                    <tbody id="myTablemoniterx">
                                    {% if bklistxs %}
                                        {% for bklistxs in bklistxs %}
                                            <tr class="tr-append-add1">
                                                <td>{{ bklistxs.5 }}</td>
                                                <td style="text-align: left">{{ bklistxs.1 }}-{{ bklistxs.2 }}</td>
                                                <td style="text-align: left">{{ bklistxs.4 }}</td>
                                                <td style="text-align: left">{{ bklistxs.3 }}</td>
                                            </tr>
                                        {% endfor %}

                                        </tbody>
                                        <tfoot>
                                        <tr class="tr-append-add1">
                                            <td style="text-align: left" colspan="2">รวม</td>
                                            <td style="text-align: left">{{ sumcount }}</td>
                                            <td style="text-align: left">{{ sumnumber }}</td>
                                        </tr>
                                        </tfoot>
                                    {% else %}
                                        <tfoot>
                                        <tr class="tr-append-add1" style="text-align: center">
                                            <td colspan="4">ไม่มีข้อมูล</td>
                                        </tr>
                                        </tfoot>
                                    {% endif %}
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- end tab-pane -->
                    <!-- begin tab-pane -->
                    <!-- end tab-pane -->
                </div>
                <!-- end tab-content -->
            </div>
        </div>
        {% csrf_token %}
    </div>
</div>
{% csrf_token %}
</body>
<script src="{% static 'doqs/assets/js/app.min.js' %}"></script>
<script src="{% static 'doqs/assets/js/theme/apple.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/d3/d3.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/nvd3/build/nv.d3.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-calendar/js/bootstrap_calendar.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/jquery-migrate/dist/jquery-migrate.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/moment/min/moment.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-datepicker/dist/js/bootstrap-datepicker.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/ion-rangeslider/js/ion.rangeSlider.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-colorpicker/dist/js/bootstrap-colorpicker.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/jquery.maskedinput/src/jquery.maskedinput.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-timepicker/js/bootstrap-timepicker.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/pwstrength-bootstrap/dist/pwstrength-bootstrap.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/@danielfarrell/bootstrap-combobox/js/bootstrap-combobox.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-select/dist/js/bootstrap-select.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/tag-it/js/tag-it.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-daterangepicker/daterangepicker.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/select2/dist/js/select2.min.js' %}"></script>
<script src="{% static 'doqs/assets/js/demo/table-manage-responsive.demo.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/d3/d3.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/eonasdan-bootstrap-datetimepicker/build/js/bootstrap-datetimepicker.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-show-password/dist/bootstrap-show-password.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/bootstrap-colorpalette/js/bootstrap-colorpalette.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/jquery-simplecolorpicker/jquery.simplecolorpicker.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/clipboard/dist/clipboard.min.js' %}"></script>
<script src="{% static 'doqs/assets/js/demo/form-plugins.demo.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/fullcalendar/dist/fullcalendar.min.js' %}"></script>
<script src="{% static 'doqs/assets/plugins/fullcalendar/dist/locale/th.js' %}"></script>
<link href="{% static 'doqs/assets/plugins/ionicons/css/ionicons.min.css' %}" rel="stylesheet"/>
<script>
    function toThaiDateStringxxxx(date) {
        let monthNames = [
            "มกราคม", "กุมภาพันธ์", "มีนาคม", "เมษายน",
            "พฤษภาคม", "มิถุนายน", "กรกฎาคม", "สิงหาคม.",
            "กันยายน", "ตุลาคม", "พฤศจิกายน", "ธันวาคม"
        ];

        let year = date.getFullYear() + 543;
        let month = monthNames[date.getMonth()];
        let numOfDay = date.getDate();

        let hour = date.getHours().toString().padStart(2, "0");
        let minutes = date.getMinutes().toString().padStart(2, "0");
        let second = date.getSeconds().toString().padStart(2, "0");

        return `${numOfDay} ${month} ${year} `;
    }

    var dateList = ''
    var OFid = ''
    var test_list_ids = ''
    var timesst = ''
    var timesse = ''
    $(document).ready(function () {
        function groupTable($rows, startIndex, total) {
            if (total === 0) {
                return;
            }
            var i, currentIndex = startIndex, count = 1, lst = [];
            var tds = $rows.find('td:eq(' + currentIndex + ')');
            var ctrl = $(tds[0]);
            lst.push($rows[0]);
            for (i = 1; i <= tds.length; i++) {
                if (ctrl.text() == $(tds[i]).text()) {
                    count++;
                    $(tds[i]).addClass('deleted');
                    lst.push($rows[i]);
                } else {
                    if (count > 1) {
                        ctrl.attr('rowspan', count);
                        groupTable($(lst), startIndex + 1, total - 1)
                    }
                    count = 1;
                    lst = [];
                    ctrl = $(tds[i]);
                    lst.push($rows[i]);
                }
            }
        }

        groupTable($('#myTablex tr:has(td)'), 0, 3);
        $('#myTablex .deleted').remove();
    });
    $(document).ready(function () {
        var calendar = $('#calendarcallqueue').fullCalendar({
                eventClick: function (info) {
                    alert('Event: ' + info.event.title);
                    alert('Coordinates: ' + info.jsEvent.pageX + ',' + info.jsEvent.pageY);
                    alert('View: ' + info.view.type);

                    // change the border color just for fun
                    info.el.style.borderColor = 'red';
                },
                displayEventTime: false,
                eventLimit: false,
                draggable: false,
                defaultView: 'listDay',
                locale: 'th',
                firstDay: 0,
                header: {
                    left: 'listDay',
                    center: 'title',
                    right: '',
                },
                events: [
                    {% for myresults in bookingshow %}
                        {
                            start: '{{ myresults.0 }}',
                            end: '{{ myresults.0 }}',
                            title: '{{ myresults.1 }} - {{ myresults.2 }}',
                            color: 'green',
                            school: '{{ myresults.0 }}',
                            timess: '{{ myresults.1 }}',
                            timesxe: '{{ myresults.2 }}',
                            timessex: '{{ myresults.1 }} - {{ myresults.2 }}',
                        },
                    {% endfor %}
                ],
                eventClick: function (event, jsEvent, view) {
                    dateList = event.school
                    OFid = "{{OFid}}"
                    timesst = event.timess
                    timesse = event.timesxe
                    timessx = event.timessex
                    test_list_ids = JSON.stringify(dateList);
                    $.ajax({
                        url: "{% url 'filtercallqueue' %}",
                        type: 'POST',
                        data: {
                            'test_list_ids': test_list_ids,
                            'OFid': OFid,
                            'timesst': timesst,
                            'timesse': timesse,
                            'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
                        },
                        success: function (data) {
                            $('.tr-append-add').remove();
                            document.getElementById('showtime').innerHTML = timessx;
                            if (data.bookingper.length > 0) {
                                jQuery.each(data.bookingper, function (index, item) {
                                    var a = item[0];
                                    if (index == 0) {
                                        $('.tr-append-add').remove();
                                    }
                                    if (item[5] == 1 && item[7] == 0) {
                                        $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                            '<td style="width: 285px;text-align: center;">' +
                                            '<span>' + item[4] + '' +
                                            '</span>' +
                                            '</td>' +
                                             '<td style="width: 50px;text-align: left">' +
                                            '<span>' + item[6] + ' ' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>' + item[3] + ' : ' + item[2] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span> ' + item[1] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left;">' +
                                            '<button  onclick="f1(this)" id="btn' + item[0] + '" class="form-control btn btn-warning btn-callqueue" value=' + item[0] + '>เรียกคิว' +
                                            '</button>' +
                                            '<div class="loader" id="loaderx' + item[0] + '">' +
                                '<button class="btn btn-warning" type="button" disabled style="width: 100%">' +
                                '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true">' +
                                '</span>รอสักครู่...' +
                                '</button>' +
                                ' </div>' +
                                            '</td>' +
                                            '</tr>')
                                    }
                                    if (item[5] == 1 && item[7] == 1) {
                                        $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                            '<td style="width: 285px;text-align: left;">' +
                                            '<span>' + item[4] + '' +
                                            '</span>' +
                                            '</td>' +
                                             '<td style="width: 50px;text-align: left">' +
                                            '<span>' + item[6] + ' ' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span>' + item[3] + ' : ' + item[2] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left">' +
                                            '<span> ' + item[1] + '' +
                                            '</span>' +
                                            '</td>' +
                                            '<td style="width: 285px;text-align: left;">' +
                                            '<label id="' + item[0] + '">' +
                                            '</label' +
                                            '</td>' +
                                            '</tr>')
                                        var a = item[9];
                                        var current_datetime = new Date(a);
                                        console.log(a)
                                        x = current_datetime.toLocaleString("th-TH", {timeZone: "UTC"})
                                        document.getElementById(item[0]).innerHTML = toThaiDateStringxxxx(current_datetime) + "" + a[10] + "" + a[11] + "" + a[12] + "" + a[13] + "" + a[14] + "" + a[15];
                                    }
                                });
                                $('.loader').hide();
                                var $tbody = $('#myTable tbody');
                                $tbody.find('tr').sort(function (a, b) {
                                    var tda = $(a).find('td:eq(0)').text();
                                    var tdb = $(b).find('td:eq(0)').text();
                                    // if a < b return 1
                                    return tda > tdb ? 1
                                        // else if a > b return -1
                                        : tda < tdb ? -1
                                            // else they are equal - return 0
                                            : 0;
                                }).appendTo($tbody);
                            } else {
                                $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                    '<td colspan="5">ไม่มีข้อมูล' +
                                    '</td>' +
                                    '</tr>')
                            }
                            $(function () {
                                function groupTable($rows, startIndex, total) {
                                    if (total === 0) {
                                        return;
                                    }
                                    var i, currentIndex = startIndex, count = 1, lst = [];
                                    var tds = $rows.find('td:eq(' + currentIndex + ')');
                                    var ctrl = $(tds[0]);
                                    lst.push($rows[0]);
                                    for (i = 1; i <= tds.length; i++) {
                                        if (ctrl.text() == $(tds[i]).text()) {
                                            count++;
                                            $(tds[i]).addClass('deleted');
                                            lst.push($rows[i]);
                                        } else {
                                            if (count > 1) {
                                                ctrl.attr('rowspan', count);
                                                groupTable($(lst), startIndex + 1, total - 1)
                                            }
                                            count = 1;
                                            lst = [];
                                            ctrl = $(tds[i]);
                                            lst.push($rows[i]);
                                        }
                                    }
                                }

                                groupTable($('#myTable tr:has(td)'), 0, 3);
                                $('#myTable .deleted').remove();
                            });
                        }
                    })
                }
            })
        ;
    });

    function checkalltime(source) {
        var checkboxes = document.querySelectorAll('input[id="checkbox1"]');
        for (var i = 0; i < checkboxes.length; i++) {
            if (checkboxes[i] != source)
                checkboxes[i].checked = source.checked;
        }
    }


    function sortTable1(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("myTable1");
        switching = true;
        //Set the sorting direction to ascending:
        dir = "asc";
        /*Make a loop that will continue until
        no switching has been done:*/
        while (switching) {
            //start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /*Loop through all table rows (except the
            first, which contains table headers):*/
            for (i = 1; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;
                /*Get the two elements you want to compare,
                one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                /*check if the two rows should switch place,
                based on the direction, asc or desc:*/
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                /*If a switch has been marked, make the switch
                and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                //Each time a switch is done, increase this count by 1:
                switchcount++;
            } else {
                /*If no switching has been done AND the direction is "asc",
                set the direction to "desc" and run the while loop again.*/
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }

    function sortTable(n) {
        var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
        table = document.getElementById("myTable");
        switching = true;
        //Set the sorting direction to ascending:
        dir = "asc";
        /*Make a loop that will continue until
        no switching has been done:*/
        while (switching) {
            //start by saying: no switching is done:
            switching = false;
            rows = table.rows;
            /*Loop through all table rows (except the
            first, which contains table headers):*/
            for (i = 1; i < (rows.length - 1); i++) {
                //start by saying there should be no switching:
                shouldSwitch = false;
                /*Get the two elements you want to compare,
                one from current row and one from the next:*/
                x = rows[i].getElementsByTagName("TD")[n];
                y = rows[i + 1].getElementsByTagName("TD")[n];
                /*check if the two rows should switch place,
                based on the direction, asc or desc:*/
                if (dir == "asc") {
                    if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                } else if (dir == "desc") {
                    if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
                        //if so, mark as a switch and break the loop:
                        shouldSwitch = true;
                        break;
                    }
                }
            }
            if (shouldSwitch) {
                /*If a switch has been marked, make the switch
                and mark that a switch has been done:*/
                rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
                switching = true;
                //Each time a switch is done, increase this count by 1:
                switchcount++;
            } else {
                /*If no switching has been done AND the direction is "asc",
                set the direction to "desc" and run the while loop again.*/
                if (switchcount == 0 && dir == "asc") {
                    dir = "desc";
                    switching = true;
                }
            }
        }
    }


    var ids = ''
    var dayclick = []
         $(document).on('click', '.btn-callqueue', function () {
           $.ajax({
            url: '//www.doo-q.com/php/testSendCloud.php?ids='+ids+'',
            type: 'GET',
            processData: false,
            contentType: false,
            success: function (data) {
            }
        });

    });
    function f1(objButton) {
        ids = objButton.value
        dayclick.push(ids);
        $('#loaderx' + ids).show();
        $('#btn' + ids).hide();
        OFid = "{{OFid}}"
        $.ajax({
            url: "{% url 'callqueueup' %}",
            type: 'POST',
            data: {
                'id': ids,
                'test_list_ids': test_list_ids,
                'timesst': timesst,
                'timesse': timesse,
                'OFid': OFid,
                'csrfmiddlewaretoken': $("[name=csrfmiddlewaretoken]").val()
            },
            success: function (data) {
                $('#loaderx' + ids).show();
                $('#btn' + ids).hide();
                $('.tr-append-add').remove();
                if (data.bookingper.length > 0) {
                    jQuery.each(data.bookingper, function (index, item) {
                        var a = item[0];
                        if (index == 0) {
                            $('.tr-append-add').remove();
                        }
                            if (item[5] == 1 && item[7] == 0) {
                                $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                    '<td style="width: 285px;">' +
                                    '<span>' + item[4] + '' +
                                    '</span>' +
                                    '</td>' +
                                    '<td style="width: 50px;text-align: left">' +
                                    '<span>' + item[6] + ' ' +
                                    '</span>' +
                                    '</td>' +
                                    '<td style="width: 285px;text-align: left">' +
                                    '<span>' + item[3] + ' : ' + item[2] + '' +
                                    '</span>' +
                                    '</td>' +
                                    '<td style="width: 285px;text-align: left">' +
                                    '<span> ' + item[1] + '' +
                                    '</span>' +
                                    '</td>' +
                                    '<td style="width: 285px;text-align: left;">' +
                                    '<button  onclick="f1(this)" id="btn' + item[0] + '" class="form-control btn btn-warning btn-callqueue" value=' + item[0] + '>เรียกคิว' +
                                    '</button>' +
                                    '<div class="loader" id="loaderx' + item[0] + '">' +
                                    '<button class="btn btn-warning" type="button" disabled style="width: 100%">' +
                                    '<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true">' +
                                    '</span>รอสักครู่...' +
                                    '</button>' +
                                    ' </div>' +
                                    '</td>' +
                                    '</tr>')
                            }
                        if (item[5] == 1 && item[7] == 1) {
                            $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                                '<td style="width: 285px">' +
                                '<span>' + item[4] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 50px;text-align: left">' +
                                '<span>' + item[6] + ' ' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span>' + item[3] + ' : ' + item[2] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left">' +
                                '<span> ' + item[1] + '' +
                                '</span>' +
                                '</td>' +
                                '<td style="width: 285px;text-align: left;">' +
                                '<label id="' + item[0] + '">' +
                                '</label' +
                                '</td>' +
                                '</tr>')
                            var a = item[9];
                            var current_datetime = new Date(a);
                            console.log(a)
                            x = current_datetime.toLocaleString("th-TH", {timeZone: "UTC"})
                            document.getElementById(item[0]).innerHTML = toThaiDateStringxxxx(current_datetime) + "" + a[10] + "" + a[11] + "" + a[12] + "" + a[13] + "" + a[14] + "" + a[15];
                        }
                    });
                    var $tbody = $('#myTable tbody');
                    $tbody.find('tr').sort(function (a, b) {
                        var tda = $(a).find('td:eq(0)').text();
                        var tdb = $(b).find('td:eq(0)').text();
                        // if a < b return 1
                        return tda > tdb ? 1
                            // else if a > b return -1
                            : tda < tdb ? -1
                                // else they are equal - return 0
                                : 0;
                    }).appendTo($tbody);
                } else {
                    $('#myTablemoniter').append('<tr class="tr-append-add"> ' +
                        '<td colspan="5">ไม่มีข้อมูล' +
                        '</td>' +
                        '</tr>')
                }
                  $('.loader').hide();
                $(function () {
                    function groupTable($rows, startIndex, total) {
                        if (total === 0) {
                            return;
                        }
                        var i, currentIndex = startIndex, count = 1, lst = [];
                        var tds = $rows.find('td:eq(' + currentIndex + ')');
                        var ctrl = $(tds[0]);
                        lst.push($rows[0]);
                        for (i = 1; i <= tds.length; i++) {
                            if (ctrl.text() == $(tds[i]).text()) {
                                count++;
                                $(tds[i]).addClass('deleted');
                                lst.push($rows[i]);
                            } else {
                                if (count > 1) {
                                    ctrl.attr('rowspan', count);
                                    groupTable($(lst), startIndex + 1, total - 1)
                                }
                                count = 1;
                                lst = [];
                                ctrl = $(tds[i]);
                                lst.push($rows[i]);
                            }
                        }
                    }

                    groupTable($('#myTable tr:has(td)'), 0, 3);
                    $('#myTable .deleted').remove();
                });
            }

        })
    }

</script>
</html>
